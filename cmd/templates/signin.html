<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>



    <link rel="stylesheet" href="signin.css">
    <style>
    html {
        height: 100%;
    }

    body {
        font-family: sans-serif;
        height: 100%;
        margin: 0px;
        padding: 0px;
        background-image: linear-gradient(#383f89, #8d2b2c);
    }

    .signin-container {
        color: white;
        max-width: 250px;
        margin: 100px auto;
        padding: 5% 4%;
    }

    .signin-string, a {
        text-align: center;
        color: white;
        text-decoration: none;
        font-weight: bold;
    }

    label {
        font-size: 0.9em;
    }

    input, button {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        border: 1px solid white;
        border-radius: 4px;
        box-sizing: border-box;
    }

    button, input[type="submit"] {
        padding: 7px 20px;
        color: #573663;
        background-color: #e1d2d2;
        font-size: 1em;
        font-weight: bold;
    }

    input{
        background-color: #441c6800;
        color: white;
        caret-color: white;
    }

    input[type=text] {
    }

    input[type=text]:focus {
    }

    input[type=password] {
    }

    input[type=password]:focus {
    }
    </style>

</head>

<body>
<div class="signin-container">

    <p class="signin-string"><a href="/">setonotes</a></p>

    <div class="input-field">
        <label>username</label><br>
        <input id="username" name="username" type="text" value="" autofocus>
    </div>

    <div class="input-field">
        <label>password</label><br>
        <input id="password" name="password" type="password" value="">
    </div>

    <button onclick="go()"><b>Sign In</b></button>

    <form id="hiddenAuthForm" method="POST">
        <input type="hidden" name="username">
        <input type="hidden" name="password">
    </form>

</div>
</body>

<script>

//import pbkdf2 from 'crypto-js/pbkdf2'
//var PBKDF2 = require('crypto-js/pbkdf2');
var CryptoJS = require("crypto-js");

function go() {
    let request_data = JSON.stringify({
        username: document.getElementById('username').value,
    });

    $.ajax({
        type: 'POST',
        url: '/api/salts',
        //dataType: 'json',
        data: request_data,
        success: function(response){
            console.log('salts: ' + JSON.stringify(response));
            //let salts = JSON.parse(response);

            // get each salt
            let auth_salt = response.auth_salt;
            console.log('auth_salt: ' + auth_salt);
            let encryption_salt = response.encryption_salt;

            // compute PBKDF2 output
            let plain_text_password = document.getElementById('password').value;
            console.log('plain_text_password: ' + plain_text_password);
            let auth_key = CryptoJS.PBKDF2(plain_text_password, auth_salt,{
                keySize: 128/32,
                iterations: 3e5,
            });
            console.log('auth_key: ' + auth_key);

            // populate hiddenAuthForm

            // submit
        },
        error: function(){
            console.log('TODO: Replace this with a user-facing error.');
        },
    });
}
</script>

</html>
